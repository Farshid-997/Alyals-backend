generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String       @id @default(uuid())
  name      String
  email     String       @unique
  password  String
  image     String?
  role      Role?        @default(user)
  contactNo String
  address   String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  reviews   UserReview[] // Reviews written by the user
  orders    Order[] // Orders placed by the user
 
 

  @@map("user")
}


model Category {
  id          String    @id @default(uuid())
  name        String
  description String?
  products    Product[] // Products belonging to the category
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("category")
}

model Product {
  id           String         @id @default(uuid())
  name         String
  description  String?
  image        String?
  price        Float // Changed to use Float for price
  Category     Category?      @relation(fields: [categoryId], references: [id])
  categoryId   String?
  stock        String?
  productstate String
  quantity     Int
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  OrderProduct OrderProduct[]
  Brand        Brand[]
  @@map("product")
}


model Brand {
  id   String @id @default(uuid())
  name String
  description String
  productId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  Product Product @relation(fields:[productId],references:[id])
  @@map("brand")
}

model UserReview {
  id        String   @id @default(uuid())
  rating    Int
  content   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  
  userId    String
  user      User     @relation(fields: [userId], references: [id])

  @@map("user_review")
}

model Order {
  id           String         @id @default(uuid())
  userId       String
  totalAmount  Float
  firstName    String
  lastName     String
  status       OrderStatus
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  orderProduct OrderProduct[] // Use a one-to-many relationship for order products
  address      String
  city         String
  postcode     String
  note         String?
  phone        String
  User         User           @relation(fields: [userId], references: [id])
  OrderCount   OrderCount[]
  count        Int            @default(0)
  @@map("order")
}
model OrderCount{
  id           String         @id @default(uuid())
  orderId      String 

  count        Int

  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  Order         Order @relation(fields: [orderId], references: [id])

  @@map("orderCounts")
}

model OrderProduct {
  id        String  @id @default(uuid())
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id])
  productId String
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int // Include the 'quantity' field

  @@map("order_product")
}


enum Role {
  superadmin
  admin
  user
}

enum OrderStatus {
  pending
  confirmed
  shipped
  delivered
  canceled
}

enum BookingStatus {
  pending
  confirmed
  canceled
  completed
}
